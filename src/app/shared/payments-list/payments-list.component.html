<section class="payments-list-container">
  <h1>Meus pagamentos</h1>

  <div class="add-payment-button-container">
    <button class="btn btn_submit" (click)="addPaymentModal.toggle()">Adicionar Pagamento</button>
  </div>

  <div class="table-header-container">
    <div class="search-container">
      <search (emmitSearch)="searchPayments($event)"></search>

      <button class="filter">
        <img src="assets/icons/filter.svg" alt="FilterIcon" width="100%" />
        Filtrar
      </button>
    </div>

    <div class="pagination-container">
      <label for="quantity">Exibir</label>
      <form [formGroup]="selectForm">
        <select id="quantity" formControlName="selectControl">
          <option *ngFor="let items of itemsPerPageCombo" [value]="items">{{ items }}</option>
        </select>
      </form>

      <div class="pages-number">
        <pagination-controls
          (pageChange)="currentPage = $event"
          previousLabel="Anterior"
          nextLabel="Próxima"
        ></pagination-controls>
      </div>
    </div>
  </div>

  <table class="payments-table-container">
    <tr class="table-header">
      <th class="th_item">
        <a id="name" class="header_sort" href="#">Usuário</a>
      </th>

      <th class="th_item">
        <a class="header_sort" href="#">Título</a>
      </th>

      <th class="th_item">
        <a class="header_sort" href="#">Data</a>
      </th>

      <th class="th_item">
        <a class="header_sort" href="#">Valor</a>
      </th>

      <th class="th_item">
        <a class="header_sort" href="#">Pago</a>
      </th>

      <th class="th_item"></th>
    </tr>

    <ng-template
      ngFor
      let-payment
      [ngForOf]="shownPayments | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage }"
    >
      <tr class="table-row" *ngIf="payment.name">
        <td class="td_item">
          {{ payment.name }}<span>@{{ payment.username }}</span>
        </td>
        <td class="td_item">{{ payment.title }}</td>
        <td class="td_item">
          {{ payment.date | date: "mediumDate":"locale":"pt-BR" }}
          <span>{{ payment.date | date: "shortTime" }}</span>
        </td>
        <td class="td_item">{{ payment.value | currency: "BRL" }}</td>

        <td class="td_item">
          <ng-template [ngIf]="payment.isPayed" [ngIfElse]="notPayed">
            <input type="checkbox" id="scales" name="scales" checked disabled />
          </ng-template>

          <ng-template #notPayed>
            <input type="checkbox" id="scales" name="scales" disabled />
          </ng-template>
        </td>

        <td class="td_item action-buttons">
          <button (click)="editPaymentModal.toggle()">
            <img src="assets/icons/edit.svg" alt="edit" width="75%" />
          </button>

          <button (click)="deletePaymentModal.toggle()">
            <img src="assets/icons/delete.svg" alt="delete" width="75%" />
          </button>
        </td>
      </tr>
    </ng-template>

    <div class="image-error" *ngIf="apiError">
      <h1>Ops... Tente novamente</h1>
      <img src="assets/search-error.png" alt="Erro de pesquisa" width="30%" />
    </div>
  </table>
</section>

<modal #addPaymentModal>
  <div class="modal-header">
    <h1>{{ modalTitle }}</h1>
  </div>

  <form class="add-payment-modal-form" (ngSubmit)="onSubmit()" #addPaymentForm="ngForm">
    <div class="form-group">
      <input class="form-control" type="text" name="name" placeholder="Usuário*" [(ngModel)]="payment.name" required />
      <input
        class="form-control"
        type="text"
        name="value"
        id="value"
        placeholder="Valor*"
        [(ngModel)]="payment.value"
        required
      />
    </div>

    <div class="form-group">
      <input
        class="form-control"
        type="text"
        name="date"
        id="date"
        placeholder="Data*"
        [(ngModel)]="payment.date"
        required
      />
      <input
        class="form-control"
        type="text"
        name="title"
        id="title"
        placeholder="Título*"
        [(ngModel)]="payment.title"
        required
      />
    </div>

    <footer class="modal-footer">
      <button class="btn btn_cancel" (click)="addPaymentModal.toggle()">Cancelar</button>
      <button class="btn btn_submit" type="submit">Salvar</button>
    </footer>
  </form>
</modal>

<modal #editPaymentModal>
  <div class="modal-header">
    <h1>{{ modalTitle }}</h1>
  </div>

  <form class="add-payment-modal-form" #editPaymentModal="ngForm">
    <div class="form-group">
      <input class="form-control" type="text" name="name" placeholder="Usuário*" [(ngModel)]="payment.name" required />
      <input
        class="form-control"
        type="text"
        name="value"
        id="value"
        placeholder="Valor*"
        [(ngModel)]="payment.value"
        required
      />
    </div>

    <div class="form-group">
      <input
        class="form-control"
        type="text"
        name="date"
        id="date"
        placeholder="Data*"
        [(ngModel)]="payment.date"
        required
      />
      <input
        class="form-control"
        type="text"
        name="title"
        id="title"
        placeholder="Título*"
        [(ngModel)]="payment.title"
        required
      />
    </div>

    <footer class="modal-footer">
      <button class="btn btn_cancel" (click)="addPaymentModal.toggle()">Cancelar</button>
      <button class="btn btn_submit" type="submit">Salvar</button>
    </footer>
  </form>
</modal>

<modal #deletePaymentModal>
  <h1>Excluir pagamento</h1>

  <form class="delete-payment-modal-form" #deletePaymentModal="ngForm">
    <div class="form-group">
      <label>Usuário</label>
      <input class="form-control" type="text" name="name" [(ngModel)]="payment.name" />
    </div>

    <div class="form-group">
      <label>Valor</label>
      <input class="form-control" type="text" name="value" [(ngModel)]="payment.value" />
    </div>

    <div class="form-group">
      <label>Data</label>
      <input class="form-control" type="text" name="date" [(ngModel)]="payment.date" />
    </div>

    <footer class="modal-footer">
      <button class="btn btn_cancel" (click)="deletePaymentModal.toggle()">Cancelar</button>
      <button class="btn btn_submit" type="submit">Salvar</button>
    </footer>
  </form>
</modal>
